[gd_scene load_steps=8 format=3 uid="uid://cghkxgbgp63bk"]

[ext_resource type="Script" uid="uid://b4hgpxw38k73o" path="res://Scripts/CardManager.gd" id="1_v1gob"]
[ext_resource type="Script" uid="uid://cfr6qyn5qtva1" path="res://Scripts/BattleManager.gd" id="2_jw32o"]
[ext_resource type="Script" uid="uid://bd2o6y7pm6ld1" path="res://Scripts/JobManager.gd" id="3_50glp"]
[ext_resource type="Script" uid="uid://c6hfgigyf8pby" path="res://Scripts/Camera.gd" id="4_vy5pj"]
[ext_resource type="PackedScene" uid="uid://dl6721ymk2skv" path="res://Scenes/SoundManager.tscn" id="5_bmxlf"]
[ext_resource type="PackedScene" uid="uid://e8ajh2rt8q5g" path="res://Scenes/UIManager.tscn" id="6_4kpch"]

[sub_resource type="GDScript" id="GDScript_21xkr"]
script/source = "extends CanvasLayer

# --- UI References ---
@onready var card_zoom_panel: Panel = $CardZoomPanel
@onready var card_zoom: TextureRect = $CardZoomPanel/CardZoomContainer/CardZoom
@onready var sprite_zoom: TextureRect = $CardZoomPanel/CardZoomContainer/SpriteZoom
@onready var card_zoom_label: Label = $CardZoomPanel/CardZoomContainer/CardZoomLabel
@onready var stats_panel_panel: Panel = $StatsPanelPanel
@onready var stats_panel: VBoxContainer = $StatsPanelPanel/StatsPanel

var current_card: Node = null

func _ready() -> void:
	card_zoom_panel.hide()
	stats_panel_panel.hide()

func _input(event: InputEvent) -> void:
	if event is InputEventMouseButton and event.button_index == MOUSE_BUTTON_RIGHT and event.pressed:
		var card_manager = get_node(\"/root/Main/CardManager\")
		var card = card_manager.raycast_check_for_card()
		if card:
			open_card_ui(card)
		
func open_card_ui(card: Node) -> void:
	if not is_instance_valid(card):
		print(\"Card is invalid!\")
		return
	# Show the panels
	card_zoom_panel.show()
	stats_panel_panel.show()
	card_zoom.show()
	sprite_zoom.show()
	card_zoom_label.show()
	# Set the textures
	card_zoom.texture = card.card_image.texture
	sprite_zoom.texture = card.sprite_image.texture
	card_zoom_label.text = card.display_name
	# --- Clear previous stats ---
	for child in stats_panel.get_children():
		child.queue_free()
	var type_label = Label.new()
	type_label.text = \"Type: %s\" % card.card_type.capitalize()
	stats_panel.add_child(type_label)
	# --- Display stats ---
	for stat_name in card.stats.keys():
		var stat_value = card.stats[stat_name]
		if typeof(stat_value) == TYPE_DICTIONARY:
			# For equipment stats like \"add\" and \"mul\"
			for sub_stat in stat_value.keys():
				var label = Label.new()
				label.text = \"%s %s%s\" % [
					sub_stat.capitalize(),
					\"+\" if stat_name == \"add\" else \"x\",
					str(stat_value[sub_stat])
				]
				stats_panel.add_child(label)
		else:
			# Normal stats like health, attack, armor
			var label = Label.new()
			label.text = \"%s: %s\" % [stat_name.capitalize(), str(stat_value)]
			stats_panel.add_child(label)
"

[node name="Main" type="Node2D"]

[node name="CardManager" type="Node2D" parent="."]
script = ExtResource("1_v1gob")

[node name="BattleManager" type="Node2D" parent="."]
script = ExtResource("2_jw32o")

[node name="JobManager" type="Node2D" parent="."]
script = ExtResource("3_50glp")

[node name="Camera2D" type="Camera2D" parent="."]
position_smoothing_enabled = true
rotation_smoothing_enabled = true
script = ExtResource("4_vy5pj")

[node name="SoundManager" parent="." instance=ExtResource("5_bmxlf")]

[node name="UIManager" parent="." instance=ExtResource("6_4kpch")]
script = SubResource("GDScript_21xkr")
